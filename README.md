# Web-ларёк

Проект представляет собой интернет-магазин, предлагающий товары, предназначенные для веб-разработчиков. В магазине имеется католог товаров, которые можно добавить в корзину и с последующим оформлением заявки сделать заказ

## Описание

Проект иммеет архитектуру по принципу Model-View-Presenter (MVP), в котором каждый класс имеет свою роль и выполняет своб определенную задачу, тем самым обеспечивая четкое разделение ответственности между классами Model и View

- Model - работа с загрузкой данных по API, сохранение и работа с данными полученными от пользователя.

- View - отображает интерфейс для взаимодействия с пользователем, отлавливает и сообщает о произошедших событиях.

- Presenter - связывает модели данных с отображением интерфейсов при сработке какого нибудь события, управляя взаимодействием между ними непосредственно в основном скрипте приложения (index.ts).

### Стек технологий:

    HTML, SCSS, TS, Webpack

### Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

### Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Описание базовых классов

### Класс `Api` имеет следующие свойства и методы.

Поля:

- `baseUrl: string` - базовый URL для всех HTTP-запросов, выполняемых с использованием этого класса.
- `options: RequestInit` - настройки для запросов, включая заголовки, методы, тело запроса и другие параметры.

Методы:

- `handleResponse(response: Response): Promise<object>` - обработчик ответа сервера.
- `get(uri: string)` - принимает динамическую часть url-адреса и возвращает ответ от сервера.
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - принимает динамическую часть url-адреса, принимает объект данных для отправки на сервер, type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'.

### Класс `EventEmitter` - брокер событий, implements от IEvents и имеет следующие методы.

Класс EventEmitter реализует паттерн «Observer/Наблюдатель» и обеспечивает работу событий, его методы позволяют устанавливать и снимать слушатели событий, вызвать слушатели при возникновении события.

Поля:

- `events: Map<EventName, Set<Subscriber>>`

Методы:

- `on<T extends object>(eventName: EventName, callback: (event: T) => void)` - для подписки на событие.
- `off(eventName: EventName, callback: Subscriber)` - для отписки от события.
- `emit<T extends object>(eventName: string, data?: T)` - уведомления подписчиков о наступлении события соответственно.
- `onAll(callback: (event: EmitterEvent) => void)` - для подписки на все события.
- `offAll()` - сброса всех подписчиков.
- `trigger<T extends object>(eventName: string, context?: Partial<T>)` - генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса `EventEmitter`.

## Описание классов Model, которые позволяют хранить и обрабатывать данные с сервера и от пользователей.

### Класс `ApiModel` наследуется от класса `Api` и относится к слою коммуникации приложения.

Его основная задача — обеспечивать взаимодействие с сервером, отправляя запросы и обрабатывая ответы.

Поля:

- `cdn: string` - URL для добавления изображения к карточкам товаров.
- `items: IProductItem[]` - массив объектов, представляющий данные о продуктах.

Методы:

- `getProductItems(): Promise<IProductItem[]>` - получаем массив карточек с сервера.
- `postOrder(order: IOrder): Promise<IOrderResult>` - отправляем запрос на сервер по сделанному/отправленному заказу.

### Класс `BasketModel` хранит список добавленных товаров и предоставляет методы для управления корзиной, включая добавление, удаление товаров, расчет общей суммы, а также очистку корзины.

Поля:

- `basketProducts: IProductItem[]` - список товаров, добавленных в корзину.

Методы:

- `getQuantity(): number` - получает количество товаров в корзине.
- `getProductsSum(): number` - считает и выводит сумму всех товаров в корзине.
- `addItemToBasket(data: IProductItem): void` - добавляет товар в корзину.
- `deleteItemFromBasket(item: IProductItem): void` - удаляет товар из корзины.
- `clearBasket(): void` - очищает корзину.

## Класс `DataModel` управляет данными о продуктах и хранит текущую выбранную карточку.

Поля:

- `productCards: IProductItem[]` - массив объектов продуктов, который хранит список всех продуктов.
- `selectedCard: IProductItem` - текущий выбранный продукт. Используется для отображения подробной информации о продукте.

Методы:

- `productCards(data: IProductItem[])` - устанавливает данные для продуктов.
- `get productCards()` - получает текущий список продуктов.
- `setPreview(item: IProductItem)` - устанавливает выбранную карточку продукта и генерирует событие открытия модального окна карточки.

### Класс `FormModel` хранит данные полученные от пользователя для оформления заказа.

Поля:

- `payment: string` - информация о методе оплаты.
- `email: string` - электронная почта пользователя.
- `phone: string` - номер телефона пользователя.
- `address: string` - адрес пользователя.
- `formErrors: FormErrors` - объект для хранения ошибок валидации, в котором ключи соответствуют полям формы, а значения содержат описание ошибок.

Методы:

- `getPayment(): string` - возвращает текущий метод оплаты.
- `setPayment(paymentData: { paymentMethod: string }): void` - устанавливает метод оплаты.
- `getEmail(): string` - возвращает текущий адрес электронной почты.
- `setEmail(value: string): void` - устанавливает адрес электронной почты.
- `getPhone(): string` - возвращает текущий номер телефона.
- `setPhone(value: string): void` - устанавливает номер телефона.
- `getAddress(): string` - возвращает текущий адрес доставки.
- `setAddress(value: string): void` - устанавливает адрес доставки.
- `getFormErrors(): FormErrors` - возвращает текущие ошибки формы.
- `setAddress(value: string): void` - устанавливает адрес доставки.
- `setOrderAddress(field: string, value: string): void` - устанавливает значение поля адреса и запускает валидацию адреса.
- `setOrderData(field: 'email' | 'phone', value: string): void` - принимает номер телефона и почту пользователя. Запускает валидацию контактов.
- `validateAdress(): boolean` - валидация адреса.
- `validateContacts(): boolean` - валидация номера телефона и почты пользователя.
- `getOrderData(): { email: string, phone: string, address: string, payment: string}` - получение всех данных заказа для формирования объекта с данными для отправки на сервер.

## Классы View позволяют отображать элементы страницы с полученными данными, позволяют взаимодействовать с пользователем.

### Класс `Basket` отвечает за отображение корзины.

Поля:

- `basket: HTMLElement` - основной DOM-элемент корзины, который будет отображен на странице.
- `title: HTMLElement` - DOM-элемент заголовка корзины.
- `basketList: HTMLElement` - DOM-элемент, который отображает список товаров корзины.
- `orderButton: HTMLElement` - кнопка для оформления заказа.
- `basketPrice: HTMLElement` - DOM-элемент, отображающий общую стоимость товаров в корзине.

Методы:

- `set items(items: HTMLElement[])` - устанавливает список товаров в корзине.
- `updateItemsList(items: HTMLElement[]): void` - обновляет список товаров в корзине.
- `renderTotal(sumAll: number): void` - отображает общую сумму товаров в корзине.
- `render(): HTMLElement` - отображает корзину с установленным заголовком "Корзина" и возвращает элемент корзины для дальнейшего использования в DOM.

### Абстрактный класс `BaseForm` служит для работы с формами. Предоставляет общий функционал для управления формой, обработкой ошибок и обработкой события отправки.

Поля:

- `form: HTMLFormElement` - DOM-элемент формы.
- `buttonSubmit: HTMLButtonElement` - кнопка отправки формы.
- `formErrors: HTMLElement` - контейнер для отображения сообщений об ошибках.

Методы:

- `set valid(value: boolean): void` - устанавливает доступность кнопки отправки формы.
- `protected abstract onSubmit(): void` - абстрактный метод, вызывающийся при отправке формы. Реализован в классах-наследниках.

### Класс `Card` управляет отображением карточки товара на веб странице.

Поля:

- `cardElement: HTMLElement` - DOM-элемент, представляющий карточку товара.
- `categoryElement: HTMLElement` - DOM-элемент, отображающий категорию товара.
- `imageElement: HTMLElement` - элемент изображения товара.
- `titleElement: HTMLElement` - элемент с названием товара.
- `priceElement: HTMLElement` - элемент с ценой товара.
- `_buttonDelete?: HTMLButtonElement` - кнопка для удаления товара (только для корзины).
- `_isBasketItem: boolean` - флаг, указывающий, является ли карточка элементом корзины.
- `colors: Record<string, string>` - объект, который сопоставляет названия категорий с CSS-классами для стилизации карточки товара.

Методы:

- `setText(element: HTMLElement, value: unknown): string` - устанавливает текстовое содержимое для переданного элемента. Возвращает установленное значение в строковом виде.
- `set cardCategory(value: string)` - устанавливает категорию товара и соответствующий ей CSS-класс для стилизации.
- `setPrice(value: number | null): string` - устанавливает цену товара.
- `render(data: IProductItem, index?: number): HTMLElement` - отображает карточку товара, устанавливая категорию, название, изображение и цену товара. Если карточка является элементом корзины, также отображается индекс товара.

### Класс `CardPreview` наследуется от класса `Card` и управляет отображением подробного описания карточки товара в превью, позволяет добавить карточку в корзину.

Поля:

- `text: HTMLElement` - DOM-элемент, отображающий описание товара в карточке товара.
- `button: HTMLElement` - кнопка добавления товара в корзину.

Методы:

- `updateButtonState(data: IProductItem, basketItems: IProductItem[]): void` - обновляет состояние кнопки "Купить" в зависимости от наличия товара в корзине и его цены.
- `render(data: IProductItem, index?: number, basketItems: IProductItem[] = []): HTMLElement` - заполняет карточку товара данными и обновляет состояние кнопки. Возвращает готовый DOM-элемент карточки.

### Класс `Contacts`(наследует BaseForm) управляет отображением содержимого модального окна и позволяет принять от пользователя номер телефона и email-адрес.

Поля:

- `inputAll: HTMLInputElement[]` - массив всех полей ввода формы.

Методы:

- `onSubmit(): void` - метод-обработчик отправки формы.

### Класс `HeaderBasket` служит для работы с кнопкой корзины в заголовке. Отвечает за открытие корзины и обновление счетчика количества товаров.

Поля:

- `buttonBasket: HTMLButtonElement` - кнопка корзины.
- `counterElement: HTMLElement` - элемент внутри кнопки для отображения количества товаров в корзине.

Методы:

- `updateQuantity(quantity: number): void` - обновляет отображение количества товаров в корзине.

### Класс `Modal` управляет модальными окнами на странице, позволяя открывать и закрывать их с заданным содержимым.

Поля:

- `modalContainer: HTMLElement` - DOM-элемент, представляющий модальное окно.
- `closeButton: HTMLButtonElement` - кнопка для закрытия модального окна.
- `content: HTMLElement` - контейнер, в который будет загружаться содержимое модального окна.

Методы:

- `set content(value: HTMLElement): void` - устанавливает содержимое модального окна.
- `open()` - открывает модальное окно.
- `close()` - закрывает модальное окно.
- `render(): HTMLElement` - отображает модальное окно.

### Класс `Order`(наследует BaseForm) служит для работы с формой оформления заказа. Обрабатывает выбор метода оплаты и ввод данных доставки.

Поля:

- `buttonAll: HTMLButtonElement[]` - массив кнопок выбора метода оплаты.

Методы:

- `paymentSelection(paymentMethod: string)` - устанавливает обводку вокруг выбранного метода оплаты.
- `onSubmit(): void` - обработчик события отправки формы.

### Класс `Page` служит для управления структурой страницы, включая галерею и состояние прокрутки.

Поля:

- `_pageElement: HTMLElement` - основной контейнер страницы.
- `_galleryElement: HTMLElement` - элемент галереи внутри страницы.

Методы:

- `addElement(context: HTMLElement): void` - добавляет новый элемент в галерею.
- `lockPage(): void` - блокирует прокрутку страницы, добавляя соответствующий класс к элементу.
- `unlockPage(): void` - снимает блокировку прокрутки страницы, удаляя соответствующий класс.

### Класс `Success` отображает сообщение об успешном завершении заказа, в котором указывается количество списанных синапсов.

Поля:

- `success: HTMLElement` - DOM-элемент, представляющий контейнер успешного завершения заказа.
- `description: HTMLElement` - элемент, в котором будет отображаться описание успешного завершения заказа.
- `button: HTMLButtonElement` - кнопка для закрытия сообщения об успешном завершении заказа.

Методы:

- `render(total: number)` - заполняет описание успешного завершения заказа информацией о списанных синапсах.

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```